# Codex Code Review - GPT-5.2-Codex
# OpenAIå…¬å¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ãŸé«˜ç²¾åº¦ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼
#
# ãƒ¢ãƒ‡ãƒ«: gpt-5.2-codex (ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç‰¹åŒ–ã€ãƒã‚°æ¤œå‡ºæœ€å¼·)
# API: Responses API

name: Codex Code Review

on:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  codex-review:
    runs-on: ubuntu-latest
    if: github.event.pull_request.draft == false

    steps:
      - uses: actions/checkout@v5
        with:
          ref: refs/pull/${{ github.event.pull_request.number }}/merge
          fetch-depth: 0

      - name: Fetch base and head refs
        run: |
          git fetch --no-tags origin \
            ${{ github.event.pull_request.base.ref }} \
            +refs/pull/${{ github.event.pull_request.number }}/head

      - name: Codex Review
        id: codex
        uses: openai/codex-action@v1
        with:
          openai-api-key: ${{ secrets.OPENAI_API_KEY }}
          prompt: |
            PR #${{ github.event.pull_request.number }} for ${{ github.repository }} ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãã ã•ã„ã€‚

            ## ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹
            1. **ãƒã‚°ãƒ»è«–ç†ã‚¨ãƒ©ãƒ¼** - æ½œåœ¨çš„ãªãƒã‚°ã€ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã€ç«¶åˆçŠ¶æ…‹
            2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£** - OWASP Top 10ã€ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€èªè¨¼/èªå¯ã®å•é¡Œ
            3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹** - N+1ã‚¯ã‚¨ãƒªã€ä¸è¦ãªãƒ«ãƒ¼ãƒ—ã€ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯
            4. **ä¿å®ˆæ€§** - DRYé•åã€è¤‡é›‘ã™ãã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã€å‘½åè¦å‰‡

            ## å‡ºåŠ›å½¢å¼
            é‡è¦ãªå•é¡Œã®ã¿æŒ‡æ‘˜ã—ã¦ãã ã•ã„ã€‚è»½å¾®ãªå•é¡Œã¯çœç•¥ã€‚

            ```
            ## ğŸ”´ Critical (ä¿®æ­£å¿…é ˆ)
            - [å•é¡Œ] (ãƒ•ã‚¡ã‚¤ãƒ«:è¡Œç•ªå·)

            ## ğŸŸ¡ Warning (æ¨å¥¨ä¿®æ­£)
            - [å•é¡Œ] (ãƒ•ã‚¡ã‚¤ãƒ«:è¡Œç•ªå·)

            ## âœ… ç·åˆè©•ä¾¡
            æ‰¿èª / è¦ä¿®æ­£ / ãƒ–ãƒ­ãƒƒã‚¯
            ```

      - name: Post Review Comment
        if: steps.codex.outputs.final-message != ''
        uses: actions/github-script@v7
        with:
          script: |
            const message = `### ğŸ¤– Codex Code Review (GPT-5.2-Codex)\n\n${{ steps.codex.outputs.final-message }}`;
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: message
            });
